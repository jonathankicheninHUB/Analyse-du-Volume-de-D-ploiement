<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Économique Dawn of Victory</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuration de la police Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Fond sombre pour un thème financier/gaming */
        }
        .card {
            background-color: #161b22;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -2px rgba(0, 0, 0, 0.5);
            border: 1px solid #30363d;
        }
        .input-style {
            background-color: #0d1117;
            border: 1px solid #30363d;
            color: #ffffff;
        }
        .result-label {
            color: #9e9e9e;
        }
        .result-value {
            font-weight: 700;
            color: #c9d1d9;
        }
    </style>
</head>
<body class="text-white p-4 sm:p-8 min-h-screen flex justify-center items-start">

    <div id="app" class="w-full max-w-5xl space-y-8 mt-10">

        <h1 class="text-3xl font-bold text-center text-teal-400 mb-6">
            Analyse du Volume de Déploiement Multi-Comptes <span class="text-yellow-400">(Ajustable)</span>
        </h1>

        <!-- Section des Paramètres d'Entrée -->
        <div class="card p-6 rounded-xl space-y-6">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-3 text-blue-300">
                1. Paramètres d'Entrée (Prix & Configuration)
            </h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                
                <!-- Nombre de Comptes -->
                <div>
                    <label for="numberOfAccounts" class="block text-sm font-medium result-label">Nombre de Comptes</label>
                    <input type="number" id="numberOfAccounts" value="1" min="1" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" inputmode="numeric">
                </div>

                <!-- Divisions par Compte (Déployées) - NOUVEAU INPUT -->
                <div>
                    <label for="divisionsPerAccount" class="block text-sm font-medium result-label">Divisions par Compte (Déployées)</label>
                    <input type="number" id="divisionsPerAccount" value="3" min="1" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" inputmode="numeric">
                </div>
                
                <!-- Sélecteur de Zone -->
                <div>
                    <label for="zoneSelector" class="block text-sm font-medium result-label">Sélectionner la Zone de Déploiement</label>
                    <select id="zoneSelector" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-teal-500 focus:border-teal-500 appearance-none">
                        <!-- Options seront remplies par JS -->
                    </select>
                </div>
                
                <!-- Prix WAX/USD -->
                <div>
                    <label for="priceWaxUsd" class="block text-sm font-medium result-label">Prix d'un WAX en USD ($)</label>
                    <input type="text" id="priceWaxUsd" value="0,05" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-pink-500 focus:border-pink-500" inputmode="decimal">
                </div>
            </div>

            <!-- Investment Packs and Price (MISE À JOUR) -->
            <div class="border-t border-gray-800 pt-4">
                <h3 class="text-sm font-medium result-label mb-3 text-lime-300">
                    Investissement Initial (Packs)
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Nombre de Packs -->
                    <div>
                        <label for="numberOfPacks" class="block text-sm font-medium result-label">Nombre de Packs Achetés (Max 10)</label>
                        <input type="number" id="numberOfPacks" value="1" min="0" max="10" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-lime-500 focus:border-lime-500" inputmode="numeric">
                    </div>

                    <!-- Divisions par Pack (NOUVEL INPUT) -->
                    <div>
                        <label for="divisionsPerPack" class="block text-sm font-medium result-label">Divisions par Pack Acheté</label>
                        <input type="number" id="divisionsPerPack" value="10" min="0" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-lime-500 focus:border-lime-500" inputmode="numeric">
                    </div>

                    <!-- Prix par Pack (USD) - CHAMP D'ENTRÉE -->
                    <div>
                        <label for="pricePerPackUsd" class="block text-sm font-medium result-label">Prix par Pack (en USD $) [Entrée]</label>
                        <input type="text" id="pricePerPackUsd" value="50,00" class="input-style mt-1 block w-full p-2.5 rounded-lg focus:ring-lime-500 focus:border-lime-500" inputmode="decimal">
                    </div>
                    <!-- Prix par Pack (WAX) - AUTOMATIQUE -->
                    <div>
                        <label for="pricePerPackWax" class="block text-sm font-medium result-label">Prix par Pack (en WAX) [Automatique]</label>
                        <input type="text" id="pricePerPackWax" value="--,-" readonly class="input-style mt-1 block w-full p-2.5 rounded-lg text-lime-400" title="Calculé: Prix USD / WAX/USD" inputmode="decimal">
                    </div>
                </div>
                
                 <!-- Total Divisions Achetées (NOUVEL AFFICHAGE) -->
                <div class="mt-4 p-3 bg-indigo-900/30 rounded-lg border border-indigo-700">
                     <p class="text-sm result-label">Total Divisions Achetées (Capacité)</p>
                     <p id="resultTotalDivisionsPurchased" class="text-xl mt-1 text-indigo-300 font-bold">--</p>
                </div>
            </div>
            
            <!-- Contrôle du prix des tokens via slider (Réglette DOVX) -->
            <div class="border-t border-gray-800 pt-4">
                <label class="block text-sm font-medium result-label mb-2 text-teal-300">
                    Ajuster le Prix du $DOVX$ (Le coût $TU$ suit le même ratio)
                </label>
                <div class="relative pt-2">
                    <!-- Slider: 200 à 200000 pour une plage de 0.00200000 à 2.00000000 WAX -->
                    <input type="range" id="dovxPriceSlider" min="200" max="200000" value="529" step="1" 
                           class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer transition duration-150 ease-in-out" 
                           oninput="document.getElementById('sliderValueDisplay').textContent=formatPriceDisplay(this.value)">
                    <p class="mt-2 text-sm text-gray-400 flex justify-between">
                        <span>Min WAX: <span id="minWaxDisplay" class="text-white">--</span></span>
                        <span class="text-yellow-400 font-bold">Prix actuel du $DOVX$: <span id="sliderValueDisplay">--</span> WAX</span>
                        <span>Max WAX: <span id="maxWaxDisplay" class="text-white">--</span></span>
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 border-t border-gray-800 pt-4">
                <!-- Prix du Jeton de Récompense (Affichage) -->
                <div>
                    <label for="priceDovX" class="block text-sm font-medium result-label">Prix WAX du Jeton de Récompense (DOVX) [Automatique]</label>
                    <input type="text" id="priceDovX" value="0,00528552" readonly class="input-style mt-1 block w-full p-2.5 rounded-lg text-green-400" title="Contrôlé par la réglette" inputmode="decimal">
                </div>
                <!-- Prix des Jetons de Coût (Affichage) -->
                <div>
                    <label for="priceCostToken" class="block text-sm font-medium result-label">Prix WAX des Jetons de Coût (TU) [Automatique]</label>
                    <input type="text" id="priceCostToken" value="0,00045262" readonly class="input-style mt-1 block w-full p-2.5 rounded-lg text-red-400" title="Ajusté automatiquement par ratio" inputmode="decimal">
                </div>
            </div>

        </div>

        <!-- Section des Résultats en WAX -->
        <div class="card p-6 rounded-xl">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-3 text-purple-300 mb-6">
                2. Volume de 24h en WAX (Total pour toutes les divisions)
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

                <!-- Coût Total WAX (Demande) - MISE À JOUR POUR LE COÛT UNITAIRE WAX TU -->
                <div class="p-3 bg-red-900/30 rounded-lg">
                    <p class="text-sm result-label">Coût Total (Demande)</p>
                    <p id="resultCost" class="text-2xl mt-1 text-red-400 result-value flex flex-col items-start">
                        <span id="totalWaxCostValue">--</span>
                        <span id="unitCostWaxValue" class="text-sm font-normal text-gray-400 mt-1">"Unitaire TU: --"</span>
                    </p>
                </div>

                <!-- Récompense Totale WAX (Offre) -->
                <div class="p-3 bg-green-900/30 rounded-lg">
                    <p class="text-sm result-label">Récompense Totale (Offre DOVX)</p>
                    <p id="resultReward" class="text-2xl mt-1 text-green-400 result-value">--</p>
                </div>

                <!-- Marge Nette WAX -->
                <div class="p-3 bg-gray-800 rounded-lg">
                    <p class="text-sm result-label">Marge/Déficit Nette (WAX)</p>
                    <p id="resultNet" class="text-2xl mt-1 result-value">--</p>
                </div>

                <!-- Volume Transactionnel Total WAX -->
                <div class="p-3 bg-blue-900/30 rounded-lg">
                    <p class="text-sm result-label">Volume Transactionnel Total (24h)</p>
                    <p id="resultVolume" class="text-2xl mt-1 text-blue-400 result-value">--</p>
                </div>
            </div>
        </div>

        <!-- Section des Résultats en USD (Journalier) -->
        <div class="card p-6 rounded-xl">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-3 text-pink-300 mb-6">
                3. Volume de 24h en USD (Total pour toutes les divisions)
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                <!-- Coût Total USD -->
                <div class="p-3 bg-red-900/30 rounded-lg">
                    <p class="text-sm result-label">Coût Total (Demande)</p>
                    <p id="resultUsdCost" class="text-2xl mt-1 text-red-400 result-value">--</p>
                </div>

                <!-- Récompense Totale USD -->
                <div class="p-3 bg-green-900/30 rounded-lg">
                    <p class="text-sm result-label">Récompense Totale (Offre DOVX)</p>
                    <p id="resultUsdReward" class="text-2xl mt-1 text-green-400 result-value">--</p>
                </div>

                <!-- Volume Transactionnel Total USD (24h) -->
                <div class="p-3 bg-blue-900/30 rounded-lg">
                    <p class="text-sm result-label">Volume Transactionnel Total</p>
                    <p id="resultUsdVolume" class="text-2xl mt-1 text-blue-400 result-value">--</p>
                </div>
            </div>
            
             <!-- Marge Nette USD (Affiche seule pour bien la mettre en évidence) -->
            <div class="mt-6 pt-4 border-t border-gray-700">
                <p class="text-sm result-label">Marge/Déficit Nette (USD $)</p>
                <p id="resultNetUsd" class="text-3xl mt-1 result-value">--</p>
            </div>
        </div>

        <!-- Section des Projections (Mensuel & Annuel) -->
        <div class="card p-6 rounded-xl">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-3 text-fuchsia-300 mb-6">
                4. Projections en USD (Mois & Année)
            </h2>

            <!-- LIGNE 1: Marge Nette -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Marge Nette Mensuelle USD -->
                <div class="p-4 bg-gray-900 rounded-lg border border-teal-700">
                    <p class="text-sm result-label">Marge Nette Mensuelle (USD $)</p>
                    <p id="resultNetUsdMonthly" class="text-3xl mt-1 result-value text-teal-400">--</p>
                </div>
                <!-- Marge Nette Annuelle USD -->
                <div class="p-4 bg-gray-900 rounded-lg border border-teal-700">
                    <p class="text-sm result-label">Marge Nette Annuelle (USD $)</p>
                    <p id="resultNetUsdAnnual" class="text-3xl mt-1 result-value text-teal-400">--</p>
                </div>
            </div>

            <!-- LIGNE 2: Volume Total -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-t border-gray-800 pt-6">
                <!-- Volume Mensuel USD -->
                <div class="p-4 bg-gray-900 rounded-lg border border-fuchsia-700">
                    <p class="text-sm result-label">Volume Transactionnel Mensuel (USD $)</p>
                    <p id="resultUsdVolumeMonthly" class="text-3xl mt-1 text-fuchsia-400 result-value">--</p>
                </div>

                <!-- Volume Annuel USD -->
                <div class="p-4 bg-gray-900 rounded-lg border border-fuchsia-700">
                    <p class="text-sm result-label">Volume Transactionnel Annuel (USD $)</p>
                    <p id="resultUsdVolumeAnnual" class="text-3xl mt-1 text-fuchsia-400 result-value">--</p>
                </div>
            </div>
        </div>
        
        <!-- Section ROI et Break-Even -->
        <div class="card p-6 rounded-xl">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-3 text-lime-300 mb-6">
                5. Analyse de l'Investissement & ROI (Basé sur le prix des packs)
            </h2>

            <!-- ROI EN POURCENTAGE -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- ROI Journalier (%) -->
                <div class="p-4 bg-gray-900 rounded-lg border border-yellow-700">
                    <p class="text-sm result-label">Rendement Journalier (ROI %) sur Investissement Total</p>
                    <p id="resultRoiDailyPercent" class="text-3xl mt-1 result-value text-yellow-400">--</p>
                </div>
                <!-- ROI Mensuel (%) -->
                <div class="p-4 bg-gray-900 rounded-lg border border-yellow-700">
                    <p class="text-sm result-label">Rendement Mensuel (ROI %) sur Investissement Total</p>
                    <p id="resultRoiMonthlyPercent" class="text-3xl mt-1 result-value text-yellow-400">--</p>
                </div>
            </div>

            <!-- Jours pour Break-Even & Statut -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 border-t border-gray-800 pt-6">

                <!-- Investissement Initial Total WAX -->
                <div class="p-3 bg-gray-900/50 rounded-lg border border-gray-600">
                    <p class="text-sm result-label">Investissement Initial Total (WAX)</p>
                    <p id="resultTotalInvestment" class="text-2xl mt-1 text-lime-400 result-value">--</p>
                </div>

                <!-- Jours pour atteindre le ROI (Break-Even) -->
                <div class="p-3 bg-gray-900/50 rounded-lg border border-gray-600">
                    <p class="text-sm result-label">Jours pour atteindre le ROI (Break-Even)</p>
                    <p id="resultRoiDays" class="text-2xl mt-1 text-lime-400 result-value">--</p>
                </div>
                
                <!-- Statut du ROI -->
                <div class="p-3 bg-gray-900/50 rounded-lg border border-gray-600">
                    <p class="text-sm result-label">Statut du ROI</p>
                    <p id="resultRoiStatus" class="text-2xl mt-1 result-value">--</p>
                </div>

            </div>
        </div>


        <!-- SECTION Consommation Nominale des Jetons de Coût -->
        <div class="card p-6 rounded-xl">
             <h3 class="text-xl font-semibold border-b border-gray-700 pb-3 text-indigo-300">
                6. Consommation Détaillée des Jetons de Coût (TU)
            </h3>
            
            <p class="text-sm text-gray-400 mt-2 mb-4">
                Détail de la consommation unitaire (par division) et projection totale journalière (pour **toutes** les divisions).
            </p>

            <div class="overflow-x-auto mb-6">
                <table class="min-w-full divide-y divide-gray-700 text-sm">
                    <thead>
                        <tr class="text-left text-gray-400 bg-gray-800/50">
                            <th class="p-3 font-medium">Jeton de Coût</th>
                            <th class="p-3 font-medium text-right">Unités TU (par 1 Division)</th>
                            <th class="p-3 font-medium text-right text-red-300">Total TU (Journalier)</th>
                            <th class="p-3 font-medium text-right">Coût WAX (par 1 Division)</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-800" id="consumptionTableBody">
                        <!-- Les lignes de données seront insérées ici par JS -->
                    </tbody>
                    <tfoot>
                        <tr class="border-t border-yellow-500/50 bg-gray-800 font-bold">
                            <td class="p-3 text-yellow-300">TOTAL (Toutes Divisions/24h)</td>
                            <td class="p-3 text-right text-yellow-300" id="totalUnitsConsumedBase">--</td>
                            <td class="p-3 text-right text-yellow-300" id="totalUnitsConsumedDailySum">--</td>
                            <td class="p-3 text-right text-yellow-300" id="totalWaxCostBase">--</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <!-- Totaux Consommation Journalière -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-700 pt-4">
                
                <div class="p-4 bg-red-900/40 rounded-lg">
                    <p class="text-sm font-bold text-gray-300">Consommation Totale TU (Journalière)</p>
                    <p id="totalUnitsConsumedDaily" class="text-2xl mt-1 text-red-300 font-extrabold">--</p>
                    <p class="text-xs text-gray-400 mt-1">Total TU requis pour tous les déploiements.</p>
                </div>

                 <div class="p-4 bg-red-900/40 rounded-lg">
                    <p class="text-sm font-bold text-gray-300">Coût Total WAX (Journalier)</p>
                    <p id="totalWaxCostDaily" class="text-2xl mt-1 text-red-300 font-extrabold">--</p>
                    <p class="text-xs text-gray-400 mt-1">Coût WAX équivalent du besoin en TU.</p>
                </div>
            </div>

            <!-- Indicateurs pour une seule division (Non multipliés) -->
            <div class="mt-6 pt-4 border-t border-gray-800">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                    <div class="text-sm">
                        <span class="font-bold text-gray-400">Unités DOVX générées (par Division):</span>
                        <span id="unitsDovXGenerated" class="text-white ml-2">--</span>
                    </div>
                    <div class="text-sm">
                        <span class="font-bold text-gray-400">Ratio d'Hyper-Amplification ($DOVX$ / Coût Unitaire TU):</span>
                        <span id="ratioAmplification" class="text-lg text-green-500 font-extrabold ml-2">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- NOUVELLE SECTION 7: RÉPARTITION DES REVENUS DES PACKS -->
        <div class="card p-6 rounded-xl">
             <h3 class="text-xl font-semibold border-b border-gray-700 pb-3 text-yellow-300">
                7. Répartition des Revenus de Vente des Packs
            </h3>
            
            <p class="text-sm text-gray-400 mt-2 mb-4">
                Distribution de l'Investissement Total ($${30\% Cash Back}, ${30\% Team}, ${30\% Market Token}, ${10\% Pub}$).
            </p>

            <!-- LIGNE 1: Totaux de l'Investissement -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 pt-4 border-t border-gray-800">
                <div class="p-3 bg-gray-900/50 rounded-lg border border-gray-600">
                    <p class="text-sm result-label">Investissement Total USD</p>
                    <p id="totalInvestmentUsdDisplay" class="text-2xl mt-1 text-lime-300 font-bold">--</p>
                </div>
                <div class="p-3 bg-gray-900/50 rounded-lg border border-gray-600">
                    <p class="text-sm result-label">Investissement Total WAX</p>
                    <p id="totalInvestmentWaxDisplay" class="text-2xl mt-1 text-lime-300 font-bold">--</p>
                </div>
            </div>

            <!-- LIGNE 2: Répartition Détaillée -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                
                <!-- Cash Back (30%) -->
                <div class="p-3 bg-blue-900/30 rounded-lg">
                    <p class="text-sm font-bold text-blue-300">Cash Back (30%)</p>
                    <p id="cashBackUsd" class="text-xl mt-1 text-white">--</p>
                    <p id="cashBackWax" class="text-xs text-blue-200">--</p>
                </div>

                <!-- Team (30%) -->
                <div class="p-3 bg-purple-900/30 rounded-lg">
                    <p class="text-sm font-bold text-purple-300">Team (30%)</p>
                    <p id="teamUsd" class="text-xl mt-1 text-white">--</p>
                    <p id="teamWax" class="text-xs text-purple-200">--</p>
                </div>

                <!-- Market Token (30%) -->
                <div class="p-3 bg-pink-900/30 rounded-lg">
                    <p class="text-sm font-bold text-pink-300">Market Token (30%)</p>
                    <p id="marketTokenUsd" class="text-xl mt-1 text-white">--</p>
                    <p id="marketTokenWax" class="text-xs text-pink-200">--</p>
                </div>

                <!-- Pub (10%) -->
                <div class="p-3 bg-amber-900/30 rounded-lg">
                    <p class="text-sm font-bold text-amber-300">Pub (10%)</p>
                    <p id="pubUsd" class="text-xl mt-1 text-white">--</p>
                    <p id="pubWax" class="text-xs text-amber-200">--</p>
                </div>
            </div>
        </div>

        <div class="text-xs text-gray-500 text-center pt-4">
            *Les coûts de combat sont basés sur la colonne 'Combat Cost' et sont divisés par 4 pour les quatre jetons de coût distincts (DOV-H, R, S, F).
        </div>
    </div>

    <script>
        // --- Globals for Ratio Calculation ---
        // Prix de base initial pour calculer le ratio
        const BASE_PRICE_DOVX = 0.00528552;
        const BASE_PRICE_COST_TOKEN = 0.00045262;
        // Ratio constant: (Prix Jeton de Coût) / (Prix DOVX)
        const COST_DOVX_RATIO = BASE_PRICE_COST_TOKEN / BASE_PRICE_DOVX;
        // Échelle utilisée pour la réglette: la valeur de la réglette (S) correspond à S / 100000 WAX
        const DOVX_SLIDER_SCALER = 100000.0; 
        
        // Constantes de temps
        const DAYS_IN_MONTH = 30;
        const DAYS_IN_YEAR = 365;
        // Nom des jetons de coût pour l'affichage détaillé
        const COST_TOKENS = ["DOV-H", "DOV-R", "DOV-S", "DOV-F"];

        // --- Fonctions de formatage ---

        /**
         * Formate une valeur numérique en chaîne WAX avec un nombre défini de décimales.
         * @param {number} value La valeur à formater.
         * @param {number} decimales Le nombre de décimales à afficher.
         * @returns {string} La chaîne formatée en WAX.
         */
        const formatWAX = (value, decimales = 6) => {
            if (isNaN(value) || !isFinite(value)) return '--';
            return value.toLocaleString('fr-FR', {
                minimumFractionDigits: decimales,
                maximumFractionDigits: decimales
            }) + ' WAX';
        };

        /**
         * Formate une valeur numérique en USD ($) avec un nombre défini de décimales.
         * @param {number} value La valeur à formater.
         * @param {number} decimales Le nombre de décimales à afficher.
         * @returns {string} La chaîne formatée en USD.
         */
        const formatUSD = (value, decimales = 4) => {
            if (isNaN(value) || !isFinite(value)) return '--';
            return value.toLocaleString('fr-FR', {
                minimumFractionDigits: decimales,
                maximumFractionDigits: decimales,
                style: 'currency',
                currency: 'USD',
            });
        };

        /**
         * Formate une valeur numérique en unités (nombre entier avec séparateur).
         * @param {number} value La valeur à formater.
         * @returns {string} La chaîne formatée en unités.
         */
        const formatUnits = (value) => {
            if (isNaN(value) || !isFinite(value)) return '--';
            // Utilise 0 décimale pour les grands nombres entiers, mais autorise 2 décimales si nécessaire
            const maxDigits = (value % 1 !== 0) ? 2 : 0;
            return value.toLocaleString('fr-FR', { maximumFractionDigits: maxDigits });
        };
        
        /**
         * Formate une valeur en pourcentage.
         * @param {number} value La valeur (ex: 0.15 pour 15%).
         * @param {number} decimales Le nombre de décimales à afficher.
         * @returns {string} La chaîne formatée en pourcentage.
         */
        const formatPercent = (value, decimales = 2) => {
            if (isNaN(value) || !isFinite(value)) return '--';
            return (value * 100).toLocaleString('fr-FR', {
                minimumFractionDigits: decimales,
                maximumFractionDigits: decimales
            }) + ' %';
        };
        
        /**
         * Convertit une chaîne de caractères française (avec virgule) en nombre flottant standard (avec point).
         * @param {string} str La chaîne de caractères à parser.
         * @returns {number} Le nombre flottant correspondant.
         */
        const parseFrenchFloat = (str) => {
            if (!str) return NaN;
            // Remplace la virgule par le point pour une conversion standard
            const standardStr = str.toString().replace(',', '.');
            return parseFloat(standardStr);
        };
        
        /**
         * Formate la valeur entière du slider en prix WAX pour l'affichage.
         * @param {string} sliderValue La valeur du slider (chaîne).
         * @returns {string} La chaîne formatée en WAX (8 décimales).
         */
        const formatPriceDisplay = (sliderValue) => {
            const price = parseInt(sliderValue) / DOVX_SLIDER_SCALER;
            return price.toLocaleString('fr-FR', { minimumFractionDigits: 8, maximumFractionDigits: 8 });
        };

        // --------------------------------------------------------------------------


        // Définition des données de base de l'économie (totalTuCost est le coût COMBINÉ des 4 jetons)
        // Les valeurs ici représentent le coût/récompense pour UNE SEULE DIVISION/DÉPLOIEMENT.
        // totalTuCost est le total, qui sera divisé par 4 pour le coût unitaire de chaque jeton.
        const ZONE_DATA = [
            { name: "beach1", totalTuCost: 4640, dovxReward: 400 }, // 1160 * 4
            { name: "beach2", totalTuCost: 27872, dovxReward: 2405 }, // 6968 * 4
            { name: "beach3", totalTuCost: 35200, dovxReward: 3037 }, // 8800 * 4
            { name: "bunker", totalTuCost: 44480, dovxReward: 3838 }, // 11120 * 4
            { name: "forest1", totalTuCost: 56096, dovxReward: 4840 }, // 14024 * 4
            { name: "forest2", totalTuCost: 70816, dovxReward: 6110 }, // 17704 * 4
            { name: "forest3", totalTuCost: 89408, dovxReward: 7714 }, // 22352 * 4
            { name: "camp", totalTuCost: 112880, dovxReward: 9739 }, // 28220 * 4
            { name: "hill1", totalTuCost: 148208, dovxReward: 12788 }, // 37052 * 4
            { name: "hill2", totalTuCost: 194608, dovxReward: 16791 }, // 48652 * 4
            { name: "hill3", totalTuCost: 258064, dovxReward: 22266 }, // 64516 * 4
            { name: "radar", totalTuCost: 338848, dovxReward: 29236 }, // 84712 * 4
            { name: "plain1", totalTuCost: 397536, dovxReward: 34300 }, // 99384 * 4
            { name: "plain2", totalTuCost: 502832, dovxReward: 43385 }, // 125708 * 4
            { name: "plain3", totalTuCost: 604656, dovxReward: 52171 }, // 151164 * 4
            { name: "HQ", totalTuCost: 752000, dovxReward: 64884 }, // 188000 * 4
            // Nouvelle zone de stacking (Exemple de valeurs pour le calcul)
            { name: "STAKING", totalTuCost: 650000, dovxReward: 50000 },
        ];

        // Éléments DOM
        const selector = document.getElementById('zoneSelector');
        const priceCostTokenInput = document.getElementById('priceCostToken');
        const priceDovXInput = document.getElementById('priceDovX');
        const priceWaxUsdInput = document.getElementById('priceWaxUsd');
        const numberOfAccountsInput = document.getElementById('numberOfAccounts');
        const divisionsPerAccountInput = document.getElementById('divisionsPerAccount');
        const dovxPriceSlider = document.getElementById('dovxPriceSlider');

        // Éléments pour le ROI et les Packs
        const numberOfPacksInput = document.getElementById('numberOfPacks');
        const divisionsPerPackInput = document.getElementById('divisionsPerPack');
        const pricePerPackWaxInput = document.getElementById('pricePerPackWax');
        const pricePerPackUsdInput = document.getElementById('pricePerPackUsd'); 
        const resultTotalDivisionsPurchasedElement = document.getElementById('resultTotalDivisionsPurchased');
        
        // NOUVEAUX ÉLÉMENTS DE RÉSULTATS POUR LE COÛT TOTAL WAX (Section 2)
        const totalWaxCostValueElement = document.getElementById('totalWaxCostValue');
        const unitCostWaxValueElement = document.getElementById('unitCostWaxValue');


        // Éléments de la nouvelle section 6
        const consumptionTableBody = document.getElementById('consumptionTableBody');
        const totalUnitsConsumedBaseElement = document.getElementById('totalUnitsConsumedBase'); 
        const totalUnitsConsumedDailySumElement = document.getElementById('totalUnitsConsumedDailySum');
        const totalWaxCostBaseElement = document.getElementById('totalWaxCostBase'); 
        const unitsDovXGeneratedElement = document.getElementById('unitsDovXGenerated');
        const ratioAmplificationElement = document.getElementById('ratioAmplification');
        const totalUnitsConsumedDailyElement = document.getElementById('totalUnitsConsumedDaily'); 
        const totalWaxCostDailyElement = document.getElementById('totalWaxCostDaily'); 

        // NOUVEAUX ÉLÉMENTS DE LA SECTION 7 (Répartition des Revenus)
        const totalInvestmentUsdDisplay = document.getElementById('totalInvestmentUsdDisplay');
        const totalInvestmentWaxDisplay = document.getElementById('totalInvestmentWaxDisplay');
        const cashBackUsd = document.getElementById('cashBackUsd');
        const cashBackWax = document.getElementById('cashBackWax');
        const teamUsd = document.getElementById('teamUsd');
        const teamWax = document.getElementById('teamWax');
        const marketTokenUsd = document.getElementById('marketTokenUsd');
        const marketTokenWax = document.getElementById('marketTokenWax');
        const pubUsd = document.getElementById('pubUsd');
        const pubWax = document.getElementById('pubWax');


        // Initialisation du sélecteur de zone - Garde l'affichage de l'unitaire en TU
        ZONE_DATA.forEach((zone, index) => {
            const unitsCostPerTokenBase = zone.totalTuCost / 4; // Coût unitaire pour un seul jeton TU (en unités TU)
            const option = document.createElement('option');
            option.value = index;
            // Coût total par division/déploiement (4 jetons)
            // Ajout de la consommation unitaire (en unités TU) entre guillemets
            option.textContent = `${zone.name.toUpperCase()} (Coût Total: ${formatUnits(zone.totalTuCost)} TU - "Unitaire: ${formatUnits(unitsCostPerTokenBase)}" TU)`;
            selector.appendChild(option);
        });


        const calculate = () => {
            const selectedIndex = parseInt(selector.value);
            const selectedZone = ZONE_DATA[selectedIndex];

            // 1. Lecture des paramètres de base
            const priceWaxUsd = parseFrenchFloat(priceWaxUsdInput.value);
            const numberOfAccounts = Math.max(1, parseInt(numberOfAccountsInput.value) || 1); 
            const divisionsPerAccount = Math.max(1, parseInt(divisionsPerAccountInput.value) || 1);
            
            // Paramètres Packs/ROI
            const numberOfPacks = Math.max(0, parseInt(numberOfPacksInput.value) || 0); 
            const divisionsPerPack = Math.max(0, parseInt(divisionsPerPackInput.value) || 0);
            
            // Calcul et affichage du total des divisions achetées
            const totalDivisionsPurchased = numberOfPacks * divisionsPerPack;
            resultTotalDivisionsPurchasedElement.textContent = formatUnits(totalDivisionsPurchased);
            
            const pricePerPackUsdInputVal = parseFrenchFloat(pricePerPackUsdInput.value);
            
            let pricePerPackWax = 0;
            if (priceWaxUsd > 0 && !isNaN(pricePerPackUsdInputVal)) {
                pricePerPackWax = pricePerPackUsdInputVal / priceWaxUsd;
            }

            pricePerPackWaxInput.value = pricePerPackWax.toLocaleString('fr-FR', { 
                minimumFractionDigits: 0, 
                maximumFractionDigits: 0 
            }); 
            
            // Investissement Total en WAX (base pour le ROI en WAX)
            const totalInvestmentWAX = numberOfPacks * pricePerPackWax;
            // Investissement Total en USD (base pour la répartition des revenus)
            const totalInvestmentUSD = numberOfPacks * pricePerPackUsdInputVal;


            // 2. Détermination des prix basés sur la réglette
            const sliderValue = parseInt(dovxPriceSlider.value);
            const newPriceDovX = sliderValue / DOVX_SLIDER_SCALER; 
            const newPriceCostToken = newPriceDovX * COST_DOVX_RATIO; // Maintient le ratio

            // Mise à jour de l'affichage des prix des tokens
            priceDovXInput.value = newPriceDovX.toLocaleString('fr-FR', { minimumFractionDigits: 8, maximumFractionDigits: 8 });
            priceCostTokenInput.value = newPriceCostToken.toLocaleString('fr-FR', { minimumFractionDigits: 8, maximumFractionDigits: 8 });
            document.getElementById('sliderValueDisplay').textContent = formatPriceDisplay(sliderValue);

            const totalMultiplier = numberOfAccounts * divisionsPerAccount;

            if (!selectedZone || isNaN(newPriceDovX) || isNaN(newPriceCostToken) || isNaN(priceWaxUsd) || isNaN(pricePerPackWax) || isNaN(totalInvestmentUSD)) {
                // Réinitialiser l'affichage si les données sont invalides
                document.querySelectorAll('.result-value').forEach(el => el.textContent = '--');
                resultTotalDivisionsPurchasedElement.textContent = '--';
                consumptionTableBody.innerHTML = '';
                totalUnitsConsumedBaseElement.textContent = '--';
                totalUnitsConsumedDailySumElement.textContent = '--';
                totalWaxCostBaseElement.textContent = '--';
                unitsDovXGeneratedElement.textContent = '--';
                ratioAmplificationElement.textContent = '--';
                totalUnitsConsumedDailyElement.textContent = '--';
                totalWaxCostDailyElement.textContent = '--';
                
                totalWaxCostValueElement.textContent = '--';
                unitCostWaxValueElement.textContent = `"Unitaire TU: --"`;
                
                // Réinitialisation de la section 7
                totalInvestmentUsdDisplay.textContent = '--';
                totalInvestmentWaxDisplay.textContent = '--';
                cashBackUsd.textContent = '--';
                cashBackWax.textContent = '--';
                teamUsd.textContent = '--';
                teamWax.textContent = '--';
                marketTokenUsd.textContent = '--';
                marketTokenWax.textContent = '--';
                pubUsd.textContent = '--';
                pubWax.textContent = '--';

                return;
            }

            // --- Calculs pour UNE SEULE division (base) ---
            const unitsCostPerTokenBase = selectedZone.totalTuCost / 4;
            const unitsDovX = selectedZone.dovxReward;

            const singleDivisionWaxCost = selectedZone.totalTuCost * newPriceCostToken; 
            const singleDivisionWaxReward = unitsDovX * newPriceDovX; 
            
            // --- Application au Volume Total (WAX) ---
            const totalWaxCost = singleDivisionWaxCost * totalMultiplier;
            const totalWaxReward = singleDivisionWaxReward * totalMultiplier;
            
            const netProfitLoss = totalWaxReward - totalWaxCost; 
            const totalVolume = totalWaxCost + totalWaxReward; 

            // --- Conversion USD ---
            const totalUsdCost = totalWaxCost * priceWaxUsd;
            const totalUsdReward = totalWaxReward * priceWaxUsd;
            const netUsdProfitLoss = netProfitLoss * priceWaxUsd; 
            const totalUsdVolume = totalVolume * priceWaxUsd; 

            // --- Calculs Mensuels & Annuels ---
            const monthlyUsdVolume = totalUsdVolume * DAYS_IN_MONTH;
            const annualUsdVolume = totalUsdVolume * DAYS_IN_YEAR;
            const monthlyNetUsdProfitLoss = netUsdProfitLoss * DAYS_IN_MONTH;
            const annualNetUsdProfitLoss = netUsdProfitLoss * DAYS_IN_YEAR;
            
            // --- Calculs de l'Investissement et ROI ---
            let roiDays = Infinity;
            let roiStatus = 'Non Applicable (Pas d\'investissement)';
            let roiDailyPercent = 0;
            let roiMonthlyPercent = 0;
            
            if (totalInvestmentWAX > 0) {
                roiDailyPercent = netProfitLoss / totalInvestmentWAX;
                roiMonthlyPercent = roiDailyPercent * DAYS_IN_MONTH;

                if (netProfitLoss > 0) {
                    roiDays = totalInvestmentWAX / netProfitLoss;
                    roiStatus = `ROI estimé en ${formatUnits(roiDays)} jours`;
                } else if (netProfitLoss < 0) {
                    roiStatus = 'Déficit : ROI impossible';
                    roiDays = Infinity;
                } else {
                    roiStatus = 'Marge Nulle : ROI impossible';
                    roiDays = Infinity;
                }
            } else {
                roiDays = Infinity;
                roiStatus = 'Non Applicable (Pas d\'investissement)';
            }


            // --- Indicateurs Stratégiques ---
            const ratioAmplification = unitsDovX / unitsCostPerTokenBase;
            
            // --- NOUVEAUX CALCULS TU TOTAUX ---
            const totalTuUnitsConsumedDaily = selectedZone.totalTuCost * totalMultiplier;
            const totalWaxCostDailyCalculated = totalTuUnitsConsumedDaily * newPriceCostToken;

            // --- CALCULS DE LA SECTION 7 (Répartition des Ventes) ---
            // Pourcentages: Cash Back (30%), Team (30%), Market Token (30%), Pub (10%)
            const CASH_BACK_PERCENT = 0.30;
            const TEAM_PERCENT = 0.30;
            const MARKET_TOKEN_PERCENT = 0.30;
            const PUB_PERCENT = 0.10;

            const cbUsd = totalInvestmentUSD * CASH_BACK_PERCENT;
            const cbWax = totalInvestmentWAX * CASH_BACK_PERCENT;
            const tmUsd = totalInvestmentUSD * TEAM_PERCENT;
            const tmWax = totalInvestmentWAX * TEAM_PERCENT;
            const mtUsd = totalInvestmentUSD * MARKET_TOKEN_PERCENT;
            const mtWax = totalInvestmentWAX * MARKET_TOKEN_PERCENT;
            const pbUsd = totalInvestmentUSD * PUB_PERCENT;
            const pbWax = totalInvestmentWAX * PUB_PERCENT;


            // --- Affichage des Résultats WAX (24h) ---
            totalWaxCostValueElement.textContent = formatWAX(totalWaxCost, 4);
            unitCostWaxValueElement.textContent = `"Unitaire TU: ${formatWAX(newPriceCostToken, 8)}"`; 

            document.getElementById('resultReward').textContent = formatWAX(totalWaxReward, 4);
            document.getElementById('resultVolume').textContent = formatWAX(totalVolume, 4);
            
            const netElement = document.getElementById('resultNet');
            netElement.textContent = formatWAX(netProfitLoss, 4);
            netElement.classList.remove('text-green-400', 'text-red-400');
            netElement.classList.add(netProfitLoss >= 0 ? 'text-green-400' : 'text-red-400');

            // --- Affichage des Résultats USD (24h) ---
            document.getElementById('resultUsdCost').textContent = formatUSD(totalUsdCost, 4);
            document.getElementById('resultUsdReward').textContent = formatUSD(totalUsdReward, 4);
            document.getElementById('resultUsdVolume').textContent = formatUSD(totalUsdVolume, 4);

            const netUsdElement = document.getElementById('resultNetUsd');
            netUsdElement.textContent = formatUSD(netUsdProfitLoss, 4);
            netUsdElement.classList.remove('text-green-400', 'text-red-400');
            netUsdElement.classList.add(netUsdProfitLoss >= 0 ? 'text-green-400' : 'text-red-400');
            
            // --- Affichage des Résultats USD (Mensuel & Annuel) ---
            document.getElementById('resultUsdVolumeMonthly').textContent = formatUSD(monthlyUsdVolume, 2);
            document.getElementById('resultUsdVolumeAnnual').textContent = formatUSD(annualUsdVolume, 2);
            
            const netUsdMonthlyElement = document.getElementById('resultNetUsdMonthly');
            netUsdMonthlyElement.textContent = formatUSD(monthlyNetUsdProfitLoss, 2);
            netUsdMonthlyElement.classList.remove('text-green-400', 'text-red-400');
            netUsdMonthlyElement.classList.add(monthlyNetUsdProfitLoss >= 0 ? 'text-green-400' : 'text-red-400');
            
            const netUsdAnnualElement = document.getElementById('resultNetUsdAnnual');
            netUsdAnnualElement.textContent = formatUSD(annualNetUsdProfitLoss, 2);
            netUsdAnnualElement.classList.remove('text-green-400', 'text-red-400');
            netUsdAnnualElement.classList.add(annualNetUsdProfitLoss >= 0 ? 'text-green-400' : 'text-red-400');
            
            // --- Affichage des Résultats ROI ---
            document.getElementById('resultTotalInvestment').textContent = formatWAX(totalInvestmentWAX, 0);

            const roiDailyPercentElement = document.getElementById('resultRoiDailyPercent');
            roiDailyPercentElement.textContent = formatPercent(roiDailyPercent, 4);
            roiDailyPercentElement.classList.remove('text-green-400', 'text-red-400');
            roiDailyPercentElement.classList.add(roiDailyPercent >= 0 ? 'text-green-400' : 'text-red-400');
            
            const roiMonthlyPercentElement = document.getElementById('resultRoiMonthlyPercent');
            roiMonthlyPercentElement.textContent = formatPercent(roiMonthlyPercent, 2);
            roiMonthlyPercentElement.classList.remove('text-green-400', 'text-red-400');
            roiMonthlyPercentElement.classList.add(roiMonthlyPercent >= 0 ? 'text-green-400' : 'text-red-400');

            const roiDaysElement = document.getElementById('resultRoiDays');
            roiDaysElement.textContent = (roiDays === Infinity) ? '--' : formatUnits(roiDays);
            
            const roiStatusElement = document.getElementById('resultRoiStatus');
            roiStatusElement.textContent = roiStatus;

            roiStatusElement.classList.remove('text-green-400', 'text-red-400', 'text-lime-400', 'text-gray-400');
            if (roiDays !== Infinity && netProfitLoss > 0) {
                roiStatusElement.classList.add('text-green-400');
            } else if (netProfitLoss < 0) {
                roiStatusElement.classList.add('text-red-400');
            } else if (totalInvestmentWAX > 0) {
                 roiStatusElement.classList.add('text-lime-400'); 
            } else {
                 roiStatusElement.classList.add('text-gray-400'); 
            }

            // --- Mise à jour de la Section 6: Consommation Nominale des Jetons de Coût ---
            let html = '';
            let totalWaxCostBase = 0;
            let totalUnitsConsumedDailySum = 0;

            for (const token of COST_TOKENS) {
                const waxCostPerToken = unitsCostPerTokenBase * newPriceCostToken;
                const totalDailyUnits = unitsCostPerTokenBase * totalMultiplier; 

                totalWaxCostBase += waxCostPerToken;
                totalUnitsConsumedDailySum += totalDailyUnits;

                html += `
                    <tr class="hover:bg-gray-800/60">
                        <td class="p-3 font-semibold text-red-300">${token}</td>
                        <td class="p-3 text-right">${formatUnits(unitsCostPerTokenBase)} unités</td>
                        <td class="p-3 text-right text-red-300 font-bold">${formatUnits(totalDailyUnits)} unités</td>
                        <td class="p-3 text-right text-red-400">${formatWAX(waxCostPerToken, 6)}</td>
                    </tr>
                `;
            }

            consumptionTableBody.innerHTML = html;
            
            totalUnitsConsumedBaseElement.textContent = formatUnits(selectedZone.totalTuCost) + ' unités';
            totalUnitsConsumedDailySumElement.textContent = formatUnits(totalUnitsConsumedDailySum) + ' unités'; 
            totalWaxCostBaseElement.textContent = formatWAX(totalWaxCostBase, 6);
            
            totalUnitsConsumedDailyElement.textContent = formatUnits(totalTuUnitsConsumedDaily) + ' unités';
            totalWaxCostDailyElement.textContent = formatWAX(totalWaxCostDailyCalculated, 4);

            unitsDovXGeneratedElement.textContent = formatUnits(unitsDovX) + ' unités';
            ratioAmplificationElement.textContent = ratioAmplification.toFixed(4) + 'x';
            
            // --- Affichage de la Section 7: Répartition des Ventes ---
            totalInvestmentUsdDisplay.textContent = formatUSD(totalInvestmentUSD, 2);
            totalInvestmentWaxDisplay.textContent = formatWAX(totalInvestmentWAX, 0);
            
            cashBackUsd.textContent = formatUSD(cbUsd, 2);
            cashBackWax.textContent = formatWAX(cbWax, 0);

            teamUsd.textContent = formatUSD(tmUsd, 2);
            teamWax.textContent = formatWAX(tmWax, 0);

            marketTokenUsd.textContent = formatUSD(mtUsd, 2);
            marketTokenWax.textContent = formatWAX(mtWax, 0);

            pubUsd.textContent = formatUSD(pbUsd, 2);
            pubWax.textContent = formatWAX(pbWax, 0);

        };

        // Initialisation de l'affichage du slider et des valeurs min/max
        const initializeSliderDisplay = () => {
            const minWaxDisplay = document.getElementById('minWaxDisplay');
            const maxWaxDisplay = document.getElementById('maxWaxDisplay');
            const sliderValueDisplay = document.getElementById('sliderValueDisplay');
            
            if (sliderValueDisplay) {
                 sliderValueDisplay.textContent = formatPriceDisplay(dovxPriceSlider.value);
            }
           
            if (minWaxDisplay) {
                minWaxDisplay.textContent = formatPriceDisplay(dovxPriceSlider.min);
            }
            if (maxWaxDisplay) {
                maxWaxDisplay.textContent = formatPriceDisplay(dovxPriceSlider.max);
            }
        };


        // Événements
        selector.addEventListener('change', calculate);
        dovxPriceSlider.addEventListener('input', calculate); 
        priceWaxUsdInput.addEventListener('input', calculate); 
        numberOfAccountsInput.addEventListener('input', calculate);
        divisionsPerAccountInput.addEventListener('input', calculate); 
        numberOfPacksInput.addEventListener('input', calculate);
        divisionsPerPackInput.addEventListener('input', calculate); 
        pricePerPackUsdInput.addEventListener('input', calculate);


        // Lancement initial au chargement
        window.onload = function() {
            initializeSliderDisplay();
            calculate();
        };

    </script>
</body>
</html>
